<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2455.2083px" preserveAspectRatio="none" style="width:901px;height:2455px;background:#00000000;" version="1.1" viewBox="0 0 901 2455" width="901.0417px" zoomAndPan="magnify"><defs><linearGradient id="ga7vdb3n3fi6q0" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#F3F3F3"/><stop offset="100%" stop-color="#E2E2E2"/></linearGradient></defs><g><ellipse cx="272.3958" cy="27.0833" fill="#336699" rx="10.4167" ry="10.4167" style="stroke:none;stroke-width:1.0416666666666667;"/><rect fill="url(#ga7vdb3n3fi6q0)" height="56.2174" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="106.25" x="219.2708" y="114.5833"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="64.5833" x="240.1042" y="147.0194">Pod exists</text><rect height="8.3333" style="stroke:none;stroke-width:1.0416666666666667;fill:none;" width="83.3333" x="230.7292" y="261.4583"/><rect fill="url(#ga7vdb3n3fi6q0)" height="99.8698" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="221.875" x="17.7083" y="357.2917"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="38.5417" y="389.7278">ResourceClaim</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="180.2083" x="38.5417" y="404.2786">for immediate allocation with</text><ellipse cx="44.2708" cy="413.9648" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="51.0417" y="418.8293">phase=pending</text><ellipse cx="44.2708" cy="428.5156" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="51.0417" y="433.3801">plugin name set</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="192.7083" x="32.2917" y="682.2917"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="53.125" y="714.7278">ResourceClaim</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="151.0417" x="53.125" y="729.2786">for immediate allocation</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="78.125" x="53.125" y="743.8293">with finalizer</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="228.125" x="83.3333" y="1316.6667"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="121.875" x="104.1667" y="1349.1028">ResourceClaim with</text><ellipse cx="109.8958" cy="1358.7891" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="116.6667" y="1363.6536">phase=allocated</text><ellipse cx="109.8958" cy="1373.3398" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="173.9583" x="116.6667" y="1378.2043">Attributes and UserLimit set</text><rect fill="url(#ga7vdb3n3fi6q0)" height="99.8698" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="207.2917" x="313.5417" y="357.2917"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="334.375" y="389.7278">ResourceClaim</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="165.625" x="334.375" y="404.2786">for delayed allocation with</text><ellipse cx="340.1042" cy="413.9648" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="346.875" y="418.8293">phase=pending</text><ellipse cx="340.1042" cy="428.5156" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="346.875" y="433.3801">plugin name set</text><rect fill="url(#ga7vdb3n3fi6q0)" height="99.8698" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="207.2917" x="313.5417" y="561.4583"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="334.375" y="593.8944">ResourceClaim</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="165.625" x="334.375" y="608.4452">for delayed allocation with</text><ellipse cx="340.1042" cy="618.1315" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="346.875" y="622.996">phase=pending</text><ellipse cx="340.1042" cy="632.6823" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="116.6667" x="346.875" y="637.5468">PotentialNodes set</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="168.75" x="332.8125" y="788.5417"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="121.875" x="353.6458" y="820.9778">ResourceClaim with</text><ellipse cx="359.375" cy="830.6641" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="366.1458" y="835.5286">phase=pending</text><ellipse cx="359.375" cy="845.2148" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="114.5833" x="366.1458" y="850.0793">SuitableNodes set</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="167.7083" x="284.375" y="951.0417"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="121.875" x="305.2083" y="983.4778">ResourceClaim with</text><ellipse cx="310.9375" cy="993.1641" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="100" x="317.7083" y="998.0286">phase=pending</text><ellipse cx="310.9375" cy="1007.7148" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="113.5417" x="317.7083" y="1012.5793">SelectedNode set</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="178.125" x="279.1667" y="1140.625"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="300" y="1173.0611">ResourceClaim</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="136.4583" x="300" y="1187.6119">for delayed allocation</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="78.125" x="300" y="1202.1627">with finalizer</text><rect fill="url(#ga7vdb3n3fi6q0)" height="70.7682" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="248.9583" x="72.9167" y="1479.1667"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="93.75" y="1511.6028">ResourceClaim</text><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="207.2917" x="93.75" y="1526.1536">with one additional UsedBy entry</text><rect fill="url(#ga7vdb3n3fi6q0)" height="56.2174" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="145.8333" x="124.4792" y="1627.0833"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="104.1667" x="145.3125" y="1659.5194">Pod ready to run</text><rect fill="url(#ga7vdb3n3fi6q0)" height="56.2174" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="95.8333" x="149.4792" y="1773.9583"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="54.1667" x="170.3125" y="1806.3944">Pod runs</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="175" x="109.8958" y="1920.8333"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="121.875" x="130.7292" y="1953.2694">ResourceClaim with</text><ellipse cx="136.4583" cy="1962.9557" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="120.8333" x="143.2292" y="1967.8202">deletion timestamp</text><ellipse cx="136.4583" cy="1977.5065" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="120.8333" x="143.2292" y="1982.371">UsedBy non-empty</text><rect fill="url(#ga7vdb3n3fi6q0)" height="85.319" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="175" x="109.8958" y="2083.3333"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="121.875" x="130.7292" y="2115.7694">ResourceClaim with</text><ellipse cx="136.4583" cy="2125.4557" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="120.8333" x="143.2292" y="2130.3202">deletion timestamp</text><ellipse cx="136.4583" cy="2140.0065" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="143.2292" y="2144.871">UsedBy empty</text><rect fill="url(#ga7vdb3n3fi6q0)" height="99.8698" rx="13.0208" ry="13.0208" style="stroke:#F3F3F3;stroke-width:1.0416666666666667;" width="204.1667" x="95.3125" y="2245.8333"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="116.1458" y="2278.2694">ResourceClaim</text><ellipse cx="121.875" cy="2287.9557" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="150" x="128.6458" y="2292.8202">with deletion timestamp</text><ellipse cx="121.875" cy="2302.5065" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="97.9167" x="128.6458" y="2307.371">without finalizer</text><ellipse cx="121.875" cy="2317.0573" fill="#336699" rx="2.6042" ry="2.6042" style="stroke:#336699;stroke-width:0.0;"/><text fill="#336699" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="83.3333" x="128.6458" y="2321.9218">phase=freed</text><ellipse cx="197.3958" cy="2433.3333" rx="10.4167" ry="10.4167" style="stroke:#336699;stroke-width:1.0416666666666667;fill:none;"/><ellipse cx="197.9167" cy="2433.8542" fill="#336699" rx="6.25" ry="6.25" style="stroke:none;stroke-width:1.0416666666666667;"/><!--MD5=[da0f8f492557236fedd4f0c24c39285f]
link start to Pod exists--><path d="M272.3958,37.8021 C272.3958,53.3646 272.3958,84.625 272.3958,108.8125 " fill="none" id="start-to-Pod exists" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="272.3958,114.1667,276.5625,104.7917,272.3958,108.9583,268.2292,104.7917,272.3958,114.1667" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="288.0208" y="80.4276"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="30.2083" x="288.0208" y="80.4276">user</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="284.375" x="322.3958" y="80.4276">creates Pod with inline ResourceClaimTemplate</text><!--MD5=[6b33e4ce99d585375e1a3cf6ad41ae27]
link Pod exists to B1--><path d="M272.3958,170.8646 C272.3958,198.1354 272.3958,238.5625 272.3958,256.0313 " fill="none" id="Pod exists-to-B1" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="272.3958,261.3646,276.5625,251.9896,272.3958,256.1562,268.2292,251.9896,272.3958,261.3646" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="288.0208" y="213.7609"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="136.4583" x="288.0208" y="213.7609">resource controller</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="310.4167" x="428.6458" y="213.7609">checks ResourceClaimTemplate and ResourceClass,</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="280.2083" x="288.0208" y="227.0991">then creates ResourceClaim with Pod as owner</text><!--MD5=[40c6350657cf657a75c8508ee2d7a8b1]
link B1 to ResourceClaim\lfor immediate allocation with\l* phase=pending\l* plugin name set--><path d="M230.6479,267.8229 C192.9677,269.8542 141.524,275.4271 128.6458,290.625 C114.591,307.2187 112.4302,330.4688 114.6143,351.7708 " fill="none" id="B1-to-ResourceClaim\lfor immediate allocation with\l* phase=pending\l* plugin name set" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="115.2585,357.1458,118.2702,347.3386,114.6336,351.9751,109.9971,348.3385,115.2585,357.1458" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="19.7917" font-weight="bold" lengthAdjust="spacing" text-decoration="underline" textLength="239.5833" x="140.1042" y="320.4544">immediate allocation</text><!--MD5=[51ab4217301fed2637034ab8a78ce330]
link ResourceClaim\lfor immediate allocation with\l* phase=pending\l* plugin name set to ResourceClaim\lfor immediate allocation\lwith finalizer--><path d="M128.6458,457.3021 C128.6458,517.1354 128.6458,617.6771 128.6458,676.7188 " fill="none" id="ResourceClaim\lfor immediate allocation with\l* phase=pending\l* plugin name set-to-ResourceClaim\lfor immediate allocation\lwith finalizer" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="128.6458,681.9479,132.8125,672.5729,128.6458,676.7396,124.4792,672.5729,128.6458,681.9479" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="144.2708" y="500.2192"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="107.2917" x="144.2708" y="500.2192">resource plugin</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="83.3333" x="144.2708" y="513.5574">updates claim</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="115.625" x="144.2708" y="526.8957">to prevent deletion</text><!--MD5=[d0b3fad2676ee95bc64dd7afb6fa0218]
link ResourceClaim\lfor immediate allocation\lwith finalizer to ALLOCATED--><path d="M128.6458,768.0208 C128.6458,805.5938 128.6458,862.2083 128.6458,911.4583 C128.6458,911.4583 128.6458,911.4583 128.6458,1184.375 C128.6458,1229.875 149.2396,1277.6771 167.8844,1311.6354 " fill="none" id="ResourceClaim\lfor immediate allocation\lwith finalizer-to-ALLOCATED" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="170.6188,1316.5417,169.7053,1306.3232,168.0881,1311.9895,162.4218,1310.3722,170.6188,1316.5417" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="144.2708" y="991.3651"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="107.2917" x="144.2708" y="991.3651">resource plugin</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="106.25" x="144.2708" y="1004.7033">finishes allocation</text><!--MD5=[9baaf0a0dd097292ccf16465b9fbcf5d]
link B1 to ResourceClaim\lfor delayed allocation with\l* phase=pending\l* plugin name set--><path d="M310.8667,269.8125 C341.4125,273.1146 380.8146,279.4271 392.1875,290.625 C408.3104,306.5 415.1865,330.125 417.7885,351.8854 " fill="none" id="B1-to-ResourceClaim\lfor delayed allocation with\l* phase=pending\l* plugin name set" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="418.3344,357.0833,421.4865,347.3204,417.7837,351.9042,413.1999,348.2014,418.3344,357.0833" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="19.7917" font-weight="bold" lengthAdjust="spacing" text-decoration="underline" textLength="207.2917" x="426.5625" y="320.4544">delayed allocation</text><!--MD5=[e58ab0efa9e5e6579ff3c72dd67c9f83]
link ResourceClaim\lfor delayed allocation with\l* phase=pending\l* plugin name set to ResourceClaim\lfor delayed allocation with\l* phase=pending\l* PotentialNodes set--><path d="M417.1875,457.7708 C417.1875,487.4792 417.1875,525.3333 417.1875,555.9063 " fill="none" id="ResourceClaim\lfor delayed allocation with\l* phase=pending\l* plugin name set-to-ResourceClaim\lfor delayed allocation with\l* phase=pending\l* PotentialNodes set" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="417.1875,561.1458,421.3542,551.7708,417.1875,555.9375,413.0208,551.7708,417.1875,561.1458" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="432.8125" y="506.9901"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="66.6667" x="432.8125" y="506.9901">scheduler</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="73.9583" x="503.6458" y="506.9901">filters nodes</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="143.75" x="432.8125" y="520.3283">and sets PotentialNodes</text><!--MD5=[27fba0200bc68843814590d882ce61f6]
link ResourceClaim\lfor delayed allocation with\l* phase=pending\l* PotentialNodes set to READY_FOR_SCHEDULING--><path d="M417.1875,661.625 C417.1875,697.8229 417.1875,746.7604 417.1875,782.5938 " fill="none" id="ResourceClaim\lfor delayed allocation with\l* phase=pending\l* PotentialNodes set-to-READY_FOR_SCHEDULING" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="417.1875,788.2188,421.3542,778.8438,417.1875,783.0104,413.0208,778.8438,417.1875,788.2188" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="432.8125" y="722.6151"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="136.4583" x="432.8125" y="722.6151">resource controller</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="81.25" x="573.4375" y="722.6151">checks nodes</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="141.6667" x="432.8125" y="735.9533">and sets SuitableNodes</text><!--MD5=[5a4a2428cddde9933a5544e58cffcad6]
link READY_FOR_SCHEDULING to ResourceClaim with\l* phase=pending\l* SelectedNode set--><path d="M335.2865,874.3021 C328.9688,880.375 323.4385,887.1875 319.2708,894.7917 C310.1698,911.3958 315.5688,929.9063 325.5594,946.3229 " fill="none" id="READY_FOR_SCHEDULING-to-ResourceClaim with\l* phase=pending\l* SelectedNode set" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="328.4906,950.8958,326.9369,940.7549,325.6789,946.5117,319.9222,945.2537,328.4906,950.8958" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="334.8958" y="916.8859"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="66.6667" x="334.8958" y="916.8859">scheduler</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="137.5" x="405.7292" y="916.8859">picks a node candidate</text><!--MD5=[8c21043d570b22137db569aa59c259fb]
link ResourceClaim with\l* phase=pending\l* SelectedNode set to ALLOCATING--><path d="M368.2292,1036.875 C368.2292,1065.9375 368.2292,1104.6458 368.2292,1134.8229 " fill="none" id="ResourceClaim with\l* phase=pending\l* SelectedNode set-to-ALLOCATING" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="368.2292,1140.3542,372.3958,1130.9792,368.2292,1135.1458,364.0625,1130.9792,368.2292,1140.3542" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="383.8542" y="1079.3859"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="107.2917" x="383.8542" y="1079.3859">resource plugin</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="83.3333" x="383.8542" y="1092.7241">updates claim</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="115.625" x="383.8542" y="1106.0623">to prevent deletion</text><!--MD5=[5ffb4374ec2a0e9ead5dd36bdbb8dd01]
link ALLOCATING to ALLOCATED--><path d="M327.3104,1226.0417 C301.7198,1252.1042 268.7365,1285.6875 242.4073,1312.5 " fill="none" id="ALLOCATING-to-ALLOCATED" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="238.5729,1316.4063,248.1206,1312.652,242.2282,1312.696,242.1842,1306.8036,238.5729,1316.4063" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="319.2708" y="1268.9692"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="107.2917" x="319.2708" y="1268.9692">resource plugin</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="106.25" x="319.2708" y="1282.3074">finishes allocation</text><!--MD5=[417016f2e0dab6c20c29a1bead297743]
link ALLOCATING to READY_FOR_SCHEDULING--><path d="M457.6458,1160.1667 C479.4708,1150.9167 500.9,1137.9375 516.1458,1119.7917 C571.7813,1053.5938 550.1104,1016.125 559.8958,930.2083 C561.6771,914.5729 568.5094,907.9688 559.8958,894.7917 C547.4271,875.7188 527.7104,862.4271 506.8656,853.1875 " fill="none" id="ALLOCATING-to-READY_FOR_SCHEDULING" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="501.8333,851.0417,508.8228,858.5516,506.6243,853.0845,512.0914,850.886,501.8333,851.0417" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="573.4375" y="984.5942"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="107.2917" x="573.4375" y="984.5942">resource plugin</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="304.1667" x="573.4375" y="997.9324">detects that resource cannot be allocated for node</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="246.875" x="573.4375" y="1011.2707">and removes SelectedNode and finalizer</text><!--MD5=[63c8692f4f7fee7b0712bd641b824ad8]
link ALLOCATED to ResourceClaim\lwith one additional UsedBy entry--><path d="M197.3958,1402.2583 C197.3958,1424.4625 197.3958,1451.6094 197.3958,1473.5313 " fill="none" id="ALLOCATED-to-ResourceClaim\lwith one additional UsedBy entry" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,1478.9865,201.5625,1469.6115,197.3958,1473.7781,193.2292,1469.6115,197.3958,1478.9865" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="1445.0109"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="66.6667" x="213.0208" y="1445.0109">scheduler</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="155.2083" x="283.8542" y="1445.0109">reserves resource for pod</text><!--MD5=[73bfb044ce03dc10984f4c83ee2f2f60]
link ResourceClaim\lwith one additional UsedBy entry to Pod ready to run--><path d="M197.3958,1550.2271 C197.3958,1572.0979 197.3958,1600.1792 197.3958,1621.6396 " fill="none" id="ResourceClaim\lwith one additional UsedBy entry-to-Pod ready to run" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,1626.9448,201.5625,1617.5698,197.3958,1621.7365,193.2292,1617.5698,197.3958,1626.9448" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="1592.9276"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="66.6667" x="213.0208" y="1592.9276">scheduler</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="86.4583" x="283.8542" y="1592.9276">schedules pod</text><!--MD5=[e0b9cda3b18e4314e0aa63843ff909e1]
link Pod ready to run to Pod runs--><path d="M197.3958,1683.4844 C197.3958,1707.6521 197.3958,1742.999 197.3958,1768.6177 " fill="none" id="Pod ready to run-to-Pod runs" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,1773.9292,201.5625,1764.5542,197.3958,1768.7208,193.2292,1764.5542,197.3958,1773.9292" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="1726.2609"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="52.0833" x="213.0208" y="1726.2609">kubelet</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="162.5" x="269.2708" y="1726.2609">calls NodePrepareResource</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="223.9583" x="213.0208" y="1739.5991">and adds CDI devices for the runtime</text><!--MD5=[e52c1bb0ccafc724f456aa5e0728a060]
link Pod runs to ResourceClaim with\l* deletion timestamp\l* UsedBy non-empty--><path d="M197.3958,1830.5229 C197.3958,1853.801 197.3958,1887.7396 197.3958,1915.3708 " fill="none" id="Pod runs-to-ResourceClaim with\l* deletion timestamp\l* UsedBy non-empty" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,1920.8073,201.5625,1911.4323,197.3958,1915.599,193.2292,1911.4323,197.3958,1920.8073" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="140.625" x="213.0208" y="1873.1359">Pod stops, gets deleted</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="1886.4741"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="123.9583" x="213.0208" y="1886.4741">garbage collector</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="201.0417" x="341.1458" y="1886.4741">marks ResourceClaim for deletion</text><!--MD5=[35c9475a316d373fecc9a1c1314c3f14]
link ResourceClaim with\l* deletion timestamp\l* UsedBy non-empty to ResourceClaim with\l* deletion timestamp\l* UsedBy empty--><path d="M197.3958,2006.3125 C197.3958,2028.2281 197.3958,2055.1667 197.3958,2077.8365 " fill="none" id="ResourceClaim with\l* deletion timestamp\l* UsedBy non-empty-to-ResourceClaim with\l* deletion timestamp\l* UsedBy empty" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,2083.2021,201.5625,2073.8271,197.3958,2077.9938,193.2292,2073.8271,197.3958,2083.2021" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="2049.1776"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="136.4583" x="213.0208" y="2049.1776">resource controller</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="210.4167" x="353.6458" y="2049.1776">removes deleted Pod from UsedBy</text><!--MD5=[013d7a0f0ade1b7162714babc2421d21]
link ResourceClaim with\l* deletion timestamp\l* UsedBy empty to ResourceClaim\l* with deletion timestamp\l* without finalizer\l* phase=freed--><path d="M197.3958,2168.9708 C197.3958,2190.5271 197.3958,2217.0688 197.3958,2240.2104 " fill="none" id="ResourceClaim with\l* deletion timestamp\l* UsedBy empty-to-ResourceClaim\l* with deletion timestamp\l* without finalizer\l* phase=freed" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,2245.7052,201.5625,2236.3302,197.3958,2240.4969,193.2292,2236.3302,197.3958,2245.7052" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="2211.6776"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="107.2917" x="213.0208" y="2211.6776">resource plugin</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="121.875" x="324.4792" y="2211.6776">finishes deallocation</text><!--MD5=[6b94a916991abb5c608314b7a5b0a799]
link ResourceClaim\l* with deletion timestamp\l* without finalizer\l* phase=freed to end--><path d="M197.3958,2346.1466 C197.3958,2371.4213 197.3958,2400.406 197.3958,2417.4875 " fill="none" id="ResourceClaim\l* with deletion timestamp\l* without finalizer\l* phase=freed-to-end" style="stroke:#E2E2E2;stroke-width:3.125;"/><polygon fill="#E2E2E2" points="197.3958,2422.8014,201.5625,2413.4264,197.3958,2417.593,193.2292,2413.4264,197.3958,2422.8014" style="stroke:#E2E2E2;stroke-width:3.125;"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="0" x="213.0208" y="2388.7609"/><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="123.9583" x="213.0208" y="2388.7609">garbage collector</text><text fill="#303030" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="138.5417" x="341.1458" y="2388.7609">deletes ResourceClaim</text><!--MD5=[cd480c0f90c44f1b0d3713e60e1589ee]
@startuml
!theme lightgray
(*) - ->[ **user** creates Pod with inline ResourceClaimTemplate ] "Pod exists"
- ->[ **resource controller** checks ResourceClaimTemplate and ResourceClass,\l then creates ResourceClaim with Pod as owner ] ==B1==

==B1== - ->[= __immediate allocation__] "ResourceClaim\lfor immediate allocation with\l* phase=pending\l* plugin name set"
  - ->[ **resource plugin**\l updates claim\l to prevent deletion] "ResourceClaim\lfor immediate allocation\lwith finalizer"
  - ->[ **resource plugin**\l finishes allocation] "ResourceClaim with\l* phase=allocated\n* Attributes and UserLimit set" as ALLOCATED


==B1== - ->[= __delayed allocation__] "ResourceClaim\lfor delayed allocation with\l* phase=pending\l* plugin name set"
  - ->[ **scheduler** filters nodes\l and sets PotentialNodes ] "ResourceClaim\lfor delayed allocation with\l* phase=pending\l* PotentialNodes set"
  - ->[ **resource controller** checks nodes\l and sets SuitableNodes] "ResourceClaim with\l* phase=pending\l* SuitableNodes set" as READY_FOR_SCHEDULING
  - ->[ **scheduler** picks a node candidate ] "ResourceClaim with\l* phase=pending\l* SelectedNode set"
  - ->[ **resource plugin**\l updates claim\l to prevent deletion] "ResourceClaim\lfor delayed allocation\lwith finalizer" as ALLOCATING
  - ->[ **resource plugin**\l finishes allocation ] ALLOCATED

  ALLOCATING - ->[ **resource plugin**\l detects that resource cannot be allocated for node\n and removes SelectedNode and finalizer ] READY_FOR_SCHEDULING

ALLOCATED - ->[ **scheduler** reserves resource for pod ]  "ResourceClaim\lwith one additional UsedBy entry"
- ->[ **scheduler** schedules pod ] "Pod ready to run"
- ->[ **kubelet** calls NodePrepareResource\l and adds CDI devices for the runtime ] "Pod runs"
- ->[ Pod stops, gets deleted\l **garbage collector** marks ResourceClaim for deletion ] "ResourceClaim with\l* deletion timestamp\l* UsedBy non-empty"
- ->[ **resource controller** removes deleted Pod from UsedBy ] "ResourceClaim with\l* deletion timestamp\l* UsedBy empty"
- ->[ **resource plugin** finishes deallocation ] "ResourceClaim\l* with deletion timestamp\l* without finalizer\l* phase=freed"
- ->[ **garbage collector** deletes ResourceClaim ] (*)
@enduml

@startuml



skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #336699
    HyperLinkColor $ORANGE
    LineColor #888888
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor #e2e2e2-#888888
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #d2d2d2
    FontColor #336699
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #303030
    FontStyle bold
  }
  separator {
    BackgroundColor #303030
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  #dbdbdb-#d2d2d2
	FontColor #e2e2e2
	BorderColor #d2d2d2
  }
  nwdiagDiagram {
	network {
			FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2    
		LineColor #e2e2e2
		LineThickness 1.0
		FontColor #888888
	}
	server {
			FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	}
	arrow {
		FontColor #888888
		LineColor #888888
	}
	group {
		BackGroundColor #fcfcfc
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
		LineColor #e2e2e2
		Margin 10
		Padding 6
	}
	note {
		FontColor #FFF
		LineColor #29527a
		BackGroundColor #336699
	}
	separator {
		LineColor #d2d2d2
		BackGroundColor #d2d2d2-#a8a8a8
		FontColor white
	}
	milestone {
		FontColor #336699
		FontSize 16
		FontStyle italic
		BackGroundColor #d2d2d2
		LineColor #a8a8a8
	}
	timeline {
		BackgroundColor #d2d2d2
		FontColor white
	}
	closed {
		BackgroundColor #cc8b35
		FontColor #FFF
	}
  }
</style>
skinparam defaultFontName        "Verdana"
skinparam defaultFontSize        12
skinparam dpi                    100
skinparam shadowing              false
skinparam roundcorner            15
skinparam ParticipantPadding     30
skinparam BoxPadding             30
skinparam Padding                10
skinparam ArrowColor             #737373
skinparam stereotype {
    CBackgroundColor #dbdbdb
    CBorderColor #a8a8a8
    ABackgroundColor #5cad5c
    ABorderColor #297a29
    IBackgroundColor #ff5c5c
    IBorderColor #cc2929
    EBackgroundColor #ffbe68
    EBorderColor #cc8b35
    NBackgroundColor #5c85ad
    NBorderColor #29527a
}
skinparam title {
	FontColor	                 white
	BorderColor	                 #d2d2d2
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #dbdbdb-#d2d2d2
}


skinparam legend {
	BackgroundColor #e2e2e2
	BorderColor #888888
	FontColor #336699
}

skinparam swimlane {
	BorderColor #336699
	BorderThickness 2
	TitleBackgroundColor  #dbdbdb-#d2d2d2
	TitleFontColor #e2e2e2
}


skinparam activity {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	BarColor #339933
	StartColor #336699
	EndColor #336699
	DiamondBackgroundColor #d2d2d2-#a8a8a8
  	DiamondBorderColor #a8a8a8
	DiamondFontColor white
}


skinparam participant {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam arrow {
	Thickness 3
	Color #e2e2e2
	FontColor #303030
}


skinparam sequence {
	BorderColor #e2e2e2
	TitleFontColor white
	BackgroundColor transparent
	StartColor #e2e2e2
	EndColor #e2e2e2
	BoxBackgroundColor #fcfcfc
	BoxBorderColor #737373
	BoxFontColor #303030
	DelayFontColor #303030
	LifeLineBorderColor #a8a8a8
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #dbdbdb
	GroupBorderColor #737373
	GroupFontColor #303030
	GroupHeaderFontColor #336699
	DividerBackgroundColor #FFF-#fcfcfc
    DividerBorderColor #737373
    DividerBorderThickness 2
    DividerFontColor #303030
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #737373
	ReferenceFontColor #303030
	ReferenceHeaderFontColor #336699
	StereotypeFontColor #336699
}


skinparam partition {
	BorderColor #e2e2e2
	FontColor #888888
	BackgroundColor transparent
}


skinparam collections {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam control {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam entity {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam boundary {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam agent {
	BackgroundColor #orange
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor #5c85ad-#336699
	BorderColor #336699
	FontColor #FFF
}


skinparam artifact {
	BackgroundColor white-#fcfcfc
	BorderColor #a8a8a8
	FontColor #a8a8a8
}


skinparam component {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam interface {
	BackgroundColor  #ff5c5c
	BorderColor  #ff3333
	FontColor #303030
}


skinparam storage {
	BackgroundColor #ffbe68-#ffae42
  	BorderColor #ffae42
	FontColor #FFF
}


skinparam node {
	BackgroundColor transparent
	BorderColor #f3f3f3
	FontColor #336699
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor $F2FCFE
	FontColor #336699
}


skinparam database {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	BackgroundColor  transparent
}


skinparam class {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	HeaderBackgroundColor #f3f3f3-#888888
	StereotypeFontColor #303030
	StereotypeFontSize 9
	BorderThickness 1
	AttributeFontColor #303030
	AttributeFontSize 11
}


skinparam object {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	StereotypeFontColor #fcfcfc
	BorderThickness 1
	AttributeFontColor #303030
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	BorderThickness 2
	StereotypeFontColor #e2e2e2
}


skinparam rectangle {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #e2e2e2
}


skinparam package {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	BackgroundColor transparent
	BorderThickness 2
}


skinparam folder {
	BackgroundColor #f3f3f3
  	BorderColor #ffae42
	FontColor #ffae42
	BorderThickness 2
}


skinparam frame {
	BackgroundColor #f3f3f3
  	BorderColor #336699
	FontColor #336699
	BorderThickness 2
}


skinparam state {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
	BorderColor #888888
	StartColor #336699
	EndColor #336699
	AttributeFontColor white
	AttributeFontSize 11
}


skinparam queue {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}


skinparam card {
	BackgroundColor #5c85ad-#336699
	BorderColor #336699
	FontColor #FFF
}


skinparam file {
	BackgroundColor #dbdbdb-#d2d2d2
	BorderColor #a8a8a8
	FontColor white

}


skinparam stack {
		FontColor #336699
	BorderColor #f3f3f3
	BackgroundColor #f3f3f3-#e2e2e2
}
(*) - ->[ **user** creates Pod with inline ResourceClaimTemplate ] "Pod exists"
- ->[ **resource controller** checks ResourceClaimTemplate and ResourceClass,\l then creates ResourceClaim with Pod as owner ] ==B1==

==B1== - ->[= __immediate allocation__] "ResourceClaim\lfor immediate allocation with\l* phase=pending\l* plugin name set"
  - ->[ **resource plugin**\l updates claim\l to prevent deletion] "ResourceClaim\lfor immediate allocation\lwith finalizer"
  - ->[ **resource plugin**\l finishes allocation] "ResourceClaim with\l* phase=allocated\n* Attributes and UserLimit set" as ALLOCATED


==B1== - ->[= __delayed allocation__] "ResourceClaim\lfor delayed allocation with\l* phase=pending\l* plugin name set"
  - ->[ **scheduler** filters nodes\l and sets PotentialNodes ] "ResourceClaim\lfor delayed allocation with\l* phase=pending\l* PotentialNodes set"
  - ->[ **resource controller** checks nodes\l and sets SuitableNodes] "ResourceClaim with\l* phase=pending\l* SuitableNodes set" as READY_FOR_SCHEDULING
  - ->[ **scheduler** picks a node candidate ] "ResourceClaim with\l* phase=pending\l* SelectedNode set"
  - ->[ **resource plugin**\l updates claim\l to prevent deletion] "ResourceClaim\lfor delayed allocation\lwith finalizer" as ALLOCATING
  - ->[ **resource plugin**\l finishes allocation ] ALLOCATED

  ALLOCATING - ->[ **resource plugin**\l detects that resource cannot be allocated for node\n and removes SelectedNode and finalizer ] READY_FOR_SCHEDULING

ALLOCATED - ->[ **scheduler** reserves resource for pod ]  "ResourceClaim\lwith one additional UsedBy entry"
- ->[ **scheduler** schedules pod ] "Pod ready to run"
- ->[ **kubelet** calls NodePrepareResource\l and adds CDI devices for the runtime ] "Pod runs"
- ->[ Pod stops, gets deleted\l **garbage collector** marks ResourceClaim for deletion ] "ResourceClaim with\l* deletion timestamp\l* UsedBy non-empty"
- ->[ **resource controller** removes deleted Pod from UsedBy ] "ResourceClaim with\l* deletion timestamp\l* UsedBy empty"
- ->[ **resource plugin** finishes deallocation ] "ResourceClaim\l* with deletion timestamp\l* without finalizer\l* phase=freed"
- ->[ **garbage collector** deletes ResourceClaim ] (*)
@enduml

PlantUML version 1.2021.16beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>